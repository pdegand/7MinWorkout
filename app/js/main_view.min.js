function launch(){controller=new Controller,controller.init()}function updateTimer(){if(maxTime>timing){var a=$(".emptyBar").width();timing+=delta/1e3;var b=a/maxTime*timing;$(".fullBar").width(b),$(".timing").css("left",b-11),$(".cursor").css("left",b-7),$(".timing").html(format(memory*maxTime+Math.round(timing,2)))}else $(".node").removeClass("inactive"),$(".node").addClass("active"),$(".cursor").fadeOut(),$(".timing").fadeOut()}function removeAllNode(){$(".node").each(function(){$(this).remove()})}function insertNode(a,b){var c=$(".emptyBar").width(),d=Math.round(a/maxTime*c-1);$(".emptyBar").append("<div class='box "+b+"' style='width:"+d+"px'></div>")}function format(a){for(var b=0;a>60;)b++,a-=60;return 10>a?b+":0"+a:b+":"+a}function cycler(){cycle=$("#steps").cycle({fx:"scrollLeft",timeout:0,after:controller.updateNextStep,speed:200}),cycleNext=$("#next_steps").cycle({fx:"scrollLeft",timeout:0,after:controller.updateNextNextStep})}function next(){$("#steps").cycle("resume",!0),$("#next_steps").cycle("resume",!0)}var controller,locale;$(document).on("smwReady",function(a,b){function c(){-1!==controller.timer.status&&(1===controller.timer.status?(d(),$("#calque").fadeIn()):(e(),$("#calque").fadeOut()))}function d(){$(".pauseButton").attr("src","img/start.png"),controller.timer.stop()}function e(){controller.timer.restart(),$(".pauseButton").attr("src","img/pause.png")}function g(){0>f||(0==f?($("#beginning .countdown").html(""),$("#next_steps").css("display","block"),$("#steps").css("display","block"),cycler(),$("#beginning").fadeOut(),setTimeout(h,500)):($("#beginning .countdown").html(f),f--))}function h(){controller.run()}locale=b.locale,controller&&controller.timer.reset(),launch(),window.onresize=function(){controller.view.initTimeline(controller.model)},$("#smwApp").click(function(){c()}),$(window).keydown(function(a){switch(a.keyCode){case 32:c()}}),$(".launchButton").click(function(){$("#bigLogo").fadeOut(),$(".countdown").fadeIn(),$(".launchButton").fadeOut(),$("#beginning .countdown").html("3"),$("#calqueInvisible").css("display","block"),setTimeout(g,1e3),setTimeout(g,2e3),setTimeout(g,3e3)});var f=2});var cursor=1,debugMultiplier=1,timing=0,maxTime=8,delta=30,memory=0,Model=function(){var a=this;this.cursor=0,this.steps=Array(),this.maxTime=0;var b;b="fr-fr"===locale?"data/exercises_fr.json":"data/exercises.json",this.init=function(){this.cursor=0,$.ajax({url:b,method:"get",contentType:"JSON",async:!1,success:function(b){for(index in b){var c=b[index];a.addStep(c.name,"hard",c.duration,c.picture),c.break&&a.addStep("Break","break",c.break,"img/break4.png")}}})},this.addStep=function(b,c,d,e){var f=Object();f.name=b,f.type=c,f.img=e,f.duration=d,a.steps[this.steps.length]=f,a.maxTime+=d},this.next=function(){return a.cursor++,a.cursor>=a.steps.length?!1:!0},this.getCurrent=function(){return a.steps[a.cursor]}},Timer=function(a){var b=this;this.fps=30,this.beginingTime,this.status=-1,this.interval=null,this.callback=a,b.getTime=function(){},b.start=function(){this.time=0,b.time=0,b.timeLap=0,b.status=1,b.beginingTime=(new Date).getTime(),this.interval=setInterval(b.update,1e3/b.fps)},b.reset=function(){clearInterval(this.interval),b.status=0,b.time=0,b.timeLap=0,b.beginingTime=(new Date).getTime()},b.stop=function(){clearInterval(this.interval),b.status=0},b.restart=function(){var a=1e3/b.fps;console.log(a),b.beginingTime=(new Date).getTime(),this.interval=setInterval(b.update,1e3/b.fps),b.status=1},b.update=function(){var a=(new Date).getTime()-b.beginingTime;b.beginingTime=(new Date).getTime(),b.time+=a*debugMultiplier,b.timeLap+=a*debugMultiplier,b.callback(b.time,b.timeLap)},b.resetLap=function(a){this.timeLap-=1e3*a}},Controller=function(){var a=this;this.model=new Model,this.init=function(){a.model.init(),a.view.initTimeline(a.model),a.view.initSlideshow(a.model)},this.run=function(){this.timer.start()},this.stop=function(){},this.update=function(b,c){var d=a.model.getCurrent();c/1e3>=d.duration&&(a.timer.resetLap(d.duration),a.model.next()||($(document).trigger("redirect"),a.timer.stop()),a.view.updateSlideshow(a.model,c,!0)),a.view.updateSlideshow(a.model,c,!1),a.view.updateTimeLine(b/1e3,a.model.maxTime)},this.nextStep=function(){},this.updateView=function(){},this.updateNextStep=function(){a.view.updateNextStep(a.model)},this.updateNextNextStep=function(){a.view.updateNextNextStep(a.model)},this.timer=new Timer(a.update),this.view=new View},View=function(){var a=this;this.stepsView=["#firstStep","#secondStep"],this.stepsNextView=["#firstNextStep","#secondNextStep"],this.cursorView=1,this.beginTransition=!1,this.totalWidth=0,this.initTimeline=function(b){var c=b.steps;$(".emptyBar").empty();for(var d=0;c.length>d;d++)a.insertStep(c[d].duration,c[d].type,b.maxTime)},this.insertStep=function(b,c,d){var e=$(".emptyBar").width()-2,f=b*e/d-1;a.totalWidth+=f,$(".emptyBar").append('<div class="stepBox '+c+'" style="width:'+f+'px"></div>')},this.updateTimeLine=function(a,b){if(b>a){var c=$(".emptyBar").width(),d=c/b*a;$(".fullBar").width(d),$(".timing").css("left",d-11),$(".cursor").css("left",d-7),$(".timing").html(format(Math.round(a,2)))}else $(".node").removeClass("inactive"),$(".node").addClass("active"),$(".pauseButton").css("display","none"),$(".cursor").fadeOut(),$(".timing").fadeOut()},this.initSlideshow=function(b){$(a.stepsView[0]+" .title").html(b.steps[0].name),$(a.stepsView[0]+" .img").attr("src",b.steps[0].img),$(a.stepsNextView[0]+" .img").attr("src",b.steps[1].img),$(a.stepsNextView[0]+" .timeLap").html(b.steps[1].duration)},this.updateNextStep=function(b){b.cursor+1<b.steps.length?($(a.stepsView[a.cursorView]+" .title").html(b.steps[b.cursor+1].name),$(a.stepsView[a.cursorView]+" .img").attr("src",b.steps[b.cursor+1].img),$(a.stepsView[a.cursorView]+" .timeLap").html(b.steps[b.cursor+1].duration)):($(a.stepsView[a.cursorView]+" .title").html(""),$(a.stepsView[a.cursorView]+" .img").remove(),$(a.stepsView[a.cursorView]+" .timeLap").html(""))},this.updateNextNextStep=function(b){b.cursor+2<b.steps.length?($(a.stepsNextView[a.cursorView]+" .img").attr("src",b.steps[b.cursor+2].img),$(a.stepsNextView[a.cursorView]+" .timeLap").html(b.steps[b.cursor+2].duration)):($(a.stepsNextView[a.cursorView]+" .title").html(""),$(a.stepsNextView[a.cursorView]+" .img").remove(),$(a.stepsNextView[a.cursorView]+" .timeLap").html("")),a.cursorView=1-a.cursorView,a.beginTransition=!1},this.updateSlideshow=function(b,c,d){if(b.cursor<b.steps.length){var e=b.steps[b.cursor].duration-c/1e3;e=e.toFixed(1),$(a.stepsView[0]+" .timeLap").html(e),$(a.stepsView[1]+" .timeLap").html(e),d&&(a.beginTransition=!0),a.beginTransition&&$(a.stepsView[a.cursorView]+" .timeLap").html("")}else $(a.stepsView[b.cursor%2]+" .title").html("");d&&($("#steps").cycle("resume",!0),$("#next_steps").cycle("resume",!0))}};